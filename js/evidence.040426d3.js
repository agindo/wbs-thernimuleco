"use strict";(self["webpackChunkwbs_2025"]=self["webpackChunkwbs_2025"]||[]).push([[388],{1835:function(e,t,s){s(4603),s(7566),s(8721);var a=s(417);const i="https://wbsreborn.lan.go.id/sylow",r=()=>localStorage.getItem("token")||sessionStorage.getItem("token"),n=()=>{const e=r(),t={"Content-Type":"multipart/form-data"};return e&&(t["Authorization"]=`Bearer ${e}`),t};class o{async uploadEvidence(e,t,s){try{const o=r();if(!o)return{success:!1,error:"Authentication token not found. Please login again.",status:401};const l=new FormData;l.append("file",e),l.append("description",t),l.append("reportId",s);const c={...n()},d=await a.A.post(`${i}/evidences/upload`,l,{headers:c,timeout:3e4,onUploadProgress:e=>{const t=Math.round(100*e.loaded/e.total);console.log(`Upload Progress: ${t}%`)}});return{success:!0,data:d.data,message:"Evidence uploaded successfully"}}catch(o){return console.error("Error uploading evidence:",o),o.response?{success:!1,error:o.response.data?.message||"Failed to upload evidence",status:o.response.status,data:o.response.data}:o.request?{success:!1,error:"Network error. Please check your connection.",status:null}:{success:!1,error:o.message||"Unexpected error occurred",status:null}}}async getEvidencesByReportId(e){try{const t=r();if(!t)return{success:!1,error:"Authentication token not found. Please login again.",status:401};const s=await a.A.get(`${i}/evidences/report/${e}`,{headers:n(),timeout:1e4});return{success:!0,data:s.data,message:"Evidences retrieved successfully"}}catch(t){return console.error("Error fetching evidences:",t),{success:!1,error:t.response?.data?.message||"Failed to fetch evidences",status:t.response?.status}}}async getEvidenceListByReportId(e){try{const t=r();if(!t)return{success:!1,error:"Authentication token not found. Please login again.",status:401};const s=await a.A.get(`${i}/evidences/report/${e}/list`,{headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},timeout:1e4});return{success:!0,data:s.data,message:"Evidence list retrieved successfully"}}catch(t){return console.error("Error fetching evidence list:",t),{success:!1,error:t.response?.data?.message||"Failed to fetch evidence list",status:t.response?.status}}}async deleteEvidence(e){try{const t=r();if(!t)return{success:!1,error:"Authentication token not found. Please login again.",status:401};const s=await a.A.delete(`${i}/evidences/${e}`,{headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},timeout:1e4});return{success:!0,data:s.data,message:"Evidence deleted successfully"}}catch(t){return console.error("Error deleting evidence:",t),{success:!1,error:t.response?.data?.message||"Failed to delete evidence",status:t.response?.status}}}async viewEvidence(e){try{const t=r();if(!t)return{success:!1,error:"Authentication token not found. Please login again.",status:401};const s=await a.A.get(`${i}/evidences/${e}/view`,{headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},responseType:"blob",timeout:3e4}),n=window.URL.createObjectURL(new Blob([s.data]));return{success:!0,data:n,headers:s.headers,message:"Evidence view URL generated successfully"}}catch(t){return console.error("Error viewing evidence:",t),{success:!1,error:t.response?.data?.message||"Failed to view evidence",status:t.response?.status}}}async downloadEvidence(e,t){try{const s=r();if(!s)return{success:!1,error:"Authentication token not found. Please login again.",status:401};const n=await a.A.get(`${i}/evidences/${e}/download`,{headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"},responseType:"blob",timeout:3e4}),o=window.URL.createObjectURL(new Blob([n.data])),l=document.createElement("a");return l.href=o,l.setAttribute("download",t||"evidence-file"),document.body.appendChild(l),l.click(),l.remove(),window.URL.revokeObjectURL(o),{success:!0,data:n.data,headers:n.headers,message:"Evidence downloaded successfully"}}catch(s){return console.error("Error downloading evidence:",s),{success:!1,error:s.response?.data?.message||"Failed to download evidence",status:s.response?.status}}}async getAllEvidences(e=0,t=10,s="createdAt",n="desc"){try{const o=r();if(!o)return{success:!1,error:"Authentication token not found. Please login again.",status:401};const l=await a.A.get(`${i}/evidences`,{params:{page:e,size:t,sortBy:s,sortDir:n},headers:{Authorization:`Bearer ${o}`,"Content-Type":"application/json"},timeout:1e4});return{success:!0,data:l.data,message:"All evidences retrieved successfully"}}catch(o){return console.error("Error fetching all evidences:",o),{success:!1,error:o.response?.data?.message||"Failed to fetch evidences",status:o.response?.status}}}}t.A=new o},4152:function(e,t,s){s.r(t),s.d(t,{default:function(){return u}});var a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"evidence-container"},[t("div",{staticClass:"evidence-header mb-6"},[t("div",{staticClass:"bg-white rounded-xl shadow-sm border border-gray-200 p-6"},[t("div",{staticClass:"flex items-center justify-between"},[e._m(0),t("div",{staticClass:"hidden md:block"},[t("div",{staticClass:"w-20 h-20 bg-gradient-to-br from-purple-500 to-purple-600 rounded-full flex items-center justify-center"},[t("Icon",{staticClass:"text-3xl text-white",attrs:{icon:"mdi:file-image"}})],1)])])])]),t("div",{staticClass:"stats-grid grid grid-cols-1 md:grid-cols-3 gap-6 mb-8"},[t("div",{staticClass:"stat-card bg-white rounded-xl shadow-sm border border-gray-200 p-6"},[t("div",{staticClass:"flex items-center justify-between"},[t("div",[t("p",{staticClass:"text-sm font-medium text-gray-600 mb-1"},[e._v("Total Evidence")]),t("p",{staticClass:"text-3xl font-bold text-gray-900"},[e._v(e._s(e.pagination.totalElements||0))])]),t("div",{staticClass:"w-12 h-12 bg-blue-500 rounded-lg flex items-center justify-center"},[t("Icon",{staticClass:"text-xl text-white",attrs:{icon:"mdi:file-multiple"}})],1)])]),t("div",{staticClass:"stat-card bg-white rounded-xl shadow-sm border border-gray-200 p-6"},[t("div",{staticClass:"flex items-center justify-between"},[t("div",[t("p",{staticClass:"text-sm font-medium text-gray-600 mb-1"},[e._v("File Gambar")]),t("p",{staticClass:"text-3xl font-bold text-gray-900"},[e._v(e._s(e.imageFiles))])]),t("div",{staticClass:"w-12 h-12 bg-green-500 rounded-lg flex items-center justify-center"},[t("Icon",{staticClass:"text-xl text-white",attrs:{icon:"mdi:image"}})],1)])]),t("div",{staticClass:"stat-card bg-white rounded-xl shadow-sm border border-gray-200 p-6"},[t("div",{staticClass:"flex items-center justify-between"},[t("div",[t("p",{staticClass:"text-sm font-medium text-gray-600 mb-1"},[e._v("File Dokumen")]),t("p",{staticClass:"text-3xl font-bold text-gray-900"},[e._v(e._s(e.documentFiles))])]),t("div",{staticClass:"w-12 h-12 bg-purple-500 rounded-lg flex items-center justify-center"},[t("Icon",{staticClass:"text-xl text-white",attrs:{icon:"mdi:file-document"}})],1)])])]),t("div",{staticClass:"filters-section bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-6"},[t("div",{staticClass:"flex flex-col lg:flex-row gap-4"},[t("div",{staticClass:"flex-1"},[t("el-input",{attrs:{placeholder:"Cari evidence berdasarkan nama file atau deskripsi...","prefix-icon":"el-icon-search",clearable:""},on:{input:e.handleSearch},model:{value:e.searchQuery,callback:function(t){e.searchQuery=t},expression:"searchQuery"}})],1),t("div",{staticClass:"flex gap-3"},[t("el-select",{attrs:{placeholder:"Tipe File",clearable:""},on:{change:e.handleFilter},model:{value:e.selectedFileType,callback:function(t){e.selectedFileType=t},expression:"selectedFileType"}},[t("el-option",{attrs:{label:"Semua File",value:""}}),t("el-option",{attrs:{label:"Gambar",value:"image"}}),t("el-option",{attrs:{label:"Dokumen",value:"document"}})],1),t("el-select",{on:{change:e.handleSort},model:{value:e.sortBy,callback:function(t){e.sortBy=t},expression:"sortBy"}},[t("el-option",{attrs:{label:"Terbaru",value:"createdAt"}}),t("el-option",{attrs:{label:"Nama File",value:"fileName"}}),t("el-option",{attrs:{label:"Ukuran File",value:"fileSize"}})],1),t("el-button",{attrs:{loading:e.loading,icon:"el-icon-refresh"},on:{click:e.refreshEvidences}},[e._v(" Refresh ")])],1)])]),t("div",{staticClass:"evidence-grid-container bg-white rounded-xl shadow-sm border border-gray-200 p-6"},[e.loading&&0===e.evidences.length?t("div",{staticClass:"loading-state text-center py-12"},[t("Icon",{staticClass:"text-4xl text-gray-400 animate-spin mb-4",attrs:{icon:"mdi:loading"}}),t("p",{staticClass:"text-gray-600"},[e._v("Memuat evidence...")])],1):0===e.evidences.length?t("div",{staticClass:"empty-state text-center py-12"},[t("Icon",{staticClass:"text-6xl text-gray-400 mb-4",attrs:{icon:"mdi:file-image-outline"}}),t("h3",{staticClass:"text-lg font-semibold text-gray-900 mb-2"},[e._v("Tidak ada evidence")]),t("p",{staticClass:"text-gray-600"},[e._v("Belum ada evidence yang diunggah")])],1):t("div",{staticClass:"masonry-grid",style:e.masonryStyle},e._l(e.evidences,function(s){return t("div",{key:s.id,staticClass:"masonry-item",style:e.getItemStyle(s)},[t("div",{staticClass:"evidence-card bg-gray-50 rounded-xl border border-gray-200 overflow-hidden hover:shadow-lg transition-all duration-300 transform hover:-translate-y-1"},[e.isImageFile(s.fileName)?t("div",{staticClass:"evidence-image relative"},[t("img",{staticClass:"w-full h-48 object-cover",attrs:{src:s.thumbnailUrl||e.getImagePlaceholder(),alt:s.fileName},on:{error:function(t){return e.handleImageError(t,s)},click:function(t){return e.viewEvidence(s)}}}),t("div",{staticClass:"absolute inset-0 bg-black bg-opacity-0 hover:bg-opacity-20 transition-all duration-300 cursor-pointer flex items-center justify-center opacity-0 hover:opacity-100"},[t("Icon",{staticClass:"text-white text-2xl",attrs:{icon:"mdi:eye"}})],1)]):t("div",{staticClass:"evidence-file-icon bg-gradient-to-br from-blue-500 to-purple-600 h-48 flex items-center justify-center"},[t("Icon",{staticClass:"text-6xl text-white",attrs:{icon:e.getFileIcon(s.fileName)}})],1),t("div",{staticClass:"p-4"},[t("h3",{staticClass:"font-semibold text-gray-900 mb-2 truncate",attrs:{title:s.fileName}},[e._v(" "+e._s(s.reportId)+" ")]),t("div",{staticClass:"file-info space-y-2 mb-4"},[t("div",{staticClass:"flex items-center text-xs text-gray-500"},[t("Icon",{staticClass:"mr-1",attrs:{icon:"mdi:calendar"}}),t("span",[e._v(e._s(e.formatDate(s.createdAt)))])],1)]),t("div",{staticClass:"actions flex gap-2"},[t("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-view"},on:{click:function(t){return e.viewEvidence(s)}}},[e._v(" Lihat ")])],1)])])])}),0),!e.pagination.last&&e.evidences.length>0?t("div",{staticClass:"load-more text-center mt-8"},[t("el-button",{attrs:{loading:e.loadingMore,size:"large",type:"primary"},on:{click:e.loadMore}},[t("Icon",{staticClass:"mr-2",attrs:{icon:"mdi:chevron-down"}}),e._v(" Muat Lebih Banyak ")],1)],1):e._e()]),t("el-dialog",{attrs:{visible:e.viewerVisible,title:e.selectedEvidence?.fileName,width:"80%",top:"20px"},on:{"update:visible":function(t){e.viewerVisible=t},close:e.closeViewer}},[e.selectedEvidence?t("div",{staticClass:"evidence-viewer"},[e.isImageFile(e.selectedEvidence.fileName)?t("div",{staticClass:"image-viewer text-center"},[t("img",{staticClass:"max-w-full max-h-96 mx-auto rounded-lg shadow-lg",attrs:{src:e.selectedEvidence.viewUrl,alt:e.selectedEvidence.fileName}})]):t("div",{staticClass:"file-viewer text-center py-12"},[t("Icon",{staticClass:"text-6xl text-gray-400 mb-4",attrs:{icon:e.getFileIcon(e.selectedEvidence.fileName)}}),t("p",{staticClass:"text-gray-600 mb-4"},[e._v(e._s(e.selectedEvidence.fileName))]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.downloadEvidence(e.selectedEvidence)}}},[t("Icon",{staticClass:"mr-2",attrs:{icon:"mdi:download"}}),e._v(" Download File ")],1)],1),t("div",{staticClass:"evidence-details mt-6 bg-gray-50 rounded-lg p-4"},[t("h4",{staticClass:"font-semibold text-gray-900 mb-3"},[e._v("Detail Evidence")]),t("div",{staticClass:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm"},[t("div",[t("span",{staticClass:"font-medium text-gray-700"},[e._v("Nama File:")]),t("span",{staticClass:"text-gray-600 ml-2"},[e._v(e._s(e.selectedEvidence.fileName))])]),t("div",[t("span",{staticClass:"font-medium text-gray-700"},[e._v("Ukuran:")]),t("span",{staticClass:"text-gray-600 ml-2"},[e._v(e._s(e.formatFileSize(e.selectedEvidence.fileSize)))])]),t("div",[t("span",{staticClass:"font-medium text-gray-700"},[e._v("Diunggah:")]),t("span",{staticClass:"text-gray-600 ml-2"},[e._v(e._s(e.formatDate(e.selectedEvidence.createdAt)))])]),e.selectedEvidence.reportId?t("div",[t("span",{staticClass:"font-medium text-gray-700"},[e._v("Report ID:")]),t("span",{staticClass:"text-gray-600 ml-2"},[e._v("#"+e._s(e.selectedEvidence.reportId))])]):e._e()]),e.selectedEvidence.description?t("div",{staticClass:"mt-3"},[t("span",{staticClass:"font-medium text-gray-700"},[e._v("Deskripsi:")]),t("p",{staticClass:"text-gray-600 mt-1"},[e._v(e._s(e.selectedEvidence.description))])]):e._e()])]):e._e()])],1)},i=[function(){var e=this,t=e._self._c;return t("div",[t("h1",{staticClass:"text-2xl font-bold text-gray-900 mb-2"},[e._v("Evidence")]),t("p",{staticClass:"text-gray-600"},[e._v("Daftar semua evidence yang telah diunggah")])])}],r=(s(4114),s(8111),s(2489),s(1701),s(8298)),n=s(1835),o={name:"Evidence",components:{Icon:r.In},data(){return{loading:!1,loadingMore:!1,evidences:[],pagination:{page:0,size:10,totalElements:0,totalPages:0,last:!0,first:!0},searchQuery:"",selectedFileType:"",sortBy:"createdAt",sortDir:"desc",viewerVisible:!1,selectedEvidence:null,columns:3,gutter:24}},computed:{imageFiles(){return Array.isArray(this.evidences)?this.evidences.filter(e=>e&&e.fileName&&this.isImageFile(e.fileName)).length:0},documentFiles(){return Array.isArray(this.evidences)?this.evidences.filter(e=>e&&e.fileName&&!this.isImageFile(e.fileName)).length:0},masonryStyle(){return{columnCount:this.columns,columnGap:`${this.gutter}px`,columnFill:"balance"}}},methods:{async fetchEvidences(e=!1){e?(this.loading=!0,this.evidences=[],this.pagination.page=0):this.loadingMore=!0;try{const t=await n.A.getAllEvidences(this.pagination.page,this.pagination.size,this.sortBy,this.sortDir);if(console.log(t),t.success&&t.data.success){const s=t.data.data.content||[],a=s.filter(e=>e&&"object"===typeof e&&e.id).map(e=>({...e,fileName:e.filename||"Unknown File",fileSize:e.sizeFile||0,description:e.description||"",createdAt:e.createdAt||(new Date).toISOString()}));e?this.evidences=a:this.evidences.push(...a),this.pagination={page:t.data.data.page||0,size:t.data.data.size||10,totalElements:t.data.data.totalElements||0,totalPages:t.data.data.totalPages||0,last:!1!==t.data.data.last,first:!1!==t.data.data.first},this.loadThumbnails(a)}}catch(t){console.error("Error fetching evidences:",t),this.$message.error("Gagal memuat data evidence")}finally{this.loading=!1,this.loadingMore=!1}},async loadThumbnails(e){for(const s of e)if(this.isImageFile(s.fileName))try{const e=await n.A.viewEvidence(s.id);e.success&&this.$set(s,"thumbnailUrl",e.data)}catch(t){console.error("Error loading thumbnail:",t),this.$set(s,"thumbnailUrl",this.getImagePlaceholder())}},async loadMore(){this.pagination.page+=1,await this.fetchEvidences(!1)},async refreshEvidences(){await this.fetchEvidences(!0)},handleSearch(){this.refreshEvidences()},handleFilter(){this.refreshEvidences()},handleSort(){this.refreshEvidences()},async viewEvidence(e){if(this.selectedEvidence=e,this.isImageFile(e.fileName)&&!e.viewUrl)try{const t=await n.A.viewEvidence(e.id);t.success&&this.$set(e,"viewUrl",t.data)}catch(t){return console.error("Error loading evidence:",t),void this.$message.error("Gagal memuat evidence")}this.viewerVisible=!0},async downloadEvidence(e){try{await n.A.downloadEvidence(e.id,e.fileName),this.$message.success("File berhasil didownload")}catch(t){console.error("Error downloading evidence:",t),this.$message.error("Gagal mendownload file")}},closeViewer(){this.viewerVisible=!1,this.selectedEvidence=null},isImageFile(e){if(!e||"string"!==typeof e)return!1;const t=[".jpg",".jpeg",".png",".gif",".bmp",".webp"];return t.some(t=>e.toLowerCase().endsWith(t))},getFileIcon(e){if(!e||"string"!==typeof e)return"mdi:file";const t=e.toLowerCase().split(".").pop(),s={pdf:"mdi:file-pdf",doc:"mdi:file-word",docx:"mdi:file-word",xls:"mdi:file-excel",xlsx:"mdi:file-excel",ppt:"mdi:file-powerpoint",pptx:"mdi:file-powerpoint",txt:"mdi:file-document-outline",zip:"mdi:zip-box",rar:"mdi:zip-box"};return s[t]||"mdi:file"},formatFileSize(e){if(!e||"number"!==typeof e)return"0 B";const t=1024,s=["B","KB","MB","GB"],a=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,a)).toFixed(2))+" "+s[a]},formatDate(e){if(!e)return"-";const t=new Date(e);return t.toLocaleDateString("id-ID",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},getItemStyle(e){return{marginBottom:`${this.gutter}px`,breakInside:"avoid",display:"inline-block",width:"100%"}},getImagePlaceholder(){return"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDMwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjMwMCIgaGVpZ2h0PSIyMDAiIGZpbGw9IiNGM0Y0RjYiLz48cGF0aCBkPSJNMTI1IDc1TDE3NSAxMjVIMTAwTDEyNSA3NVoiIGZpbGw9IiM5Q0EzQUYiLz48Y2lyY2xlIGN4PSIxMjUiIGN5PSI3NSIgcj0iMTAiIGZpbGw9IiM5Q0EzQUYiLz48L3N2Zz4="},handleImageError(e,t){e.target.src=this.getImagePlaceholder()},updateColumnCount(){const e=window.innerWidth;this.columns=e>=1280?4:e>=1024?3:e>=768?2:1}},mounted(){this.fetchEvidences(!0),this.updateColumnCount(),window.addEventListener("resize",this.updateColumnCount)},beforeDestroy(){window.removeEventListener("resize",this.updateColumnCount)}},l=o,c=s(1656),d=(0,c.A)(l,a,i,!1,null,"62f6073a",null),u=d.exports}}]);
//# sourceMappingURL=evidence.040426d3.js.map